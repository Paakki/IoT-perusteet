<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ThingSpeak Temperature Chart</title>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
    <script type="text/javascript">
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(fetchData);

      async function fetchData() {
        try {
          const url =
            "https://api.thingspeak.com/channels/3085300/feeds.json?api_key=WNICNT0VZM3D99YE";

          const response = await fetch(url);
          const data = await response.json();

          const feeds = data.feeds;

          const chartData = [["Time", "Temperature"]];

          feeds.forEach((feed) => {
            const time = new Date(feed.created_at);
            const temp = parseFloat(feed.field1);
            if (!isNaN(temp)) {
              chartData.push([time, temp]);
            }
          });

          drawChart(chartData);
        } catch (error) {
          console.error("Error fetching data from ThingSpeak:", error);
        }
      }

      function drawChart(chartData) {
        const data = google.visualization.arrayToDataTable(chartData);

        const options = {
          title: "Temperature Over Time",
          curveType: "function",
          legend: { position: "bottom" },
          hAxis: {
            title: "Date",
            format: "yyyy-MM-dd",
          },
          vAxis: {
            title: "Temperature (Â°C)",
          },
        };

        const chart = new google.visualization.LineChart(
          document.getElementById("curve_chart")
        );
        chart.draw(data, options);
      }
    </script>
  </head>
  <body>
    <h1>Temperature Line Chart</h1>
    <div id="curve_chart" style="width: 900px; height: 500px"></div>
  </body>
</html>
